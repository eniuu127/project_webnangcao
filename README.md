# ğŸ§¥ Website BÃ¡n Quáº§n Ão - Clothing Shop

## ğŸ‘©â€ğŸ“ ThÃ´ng tin sinh viÃªn
- **Há» vÃ  tÃªn:** VÅ© Thá»‹ Háº£i Yáº¿n  
- **MÃ£ sinh viÃªn:** 23010421  
- **Lá»›p:** K17-CNTT4  
- **MÃ´n há»c:** Thiáº¿t káº¿ Web nÃ¢ng cao (TH3)

---
## ğŸ“„ Giá»›i thiá»‡u dá»± Ã¡n

**Clothing Shop** lÃ  website thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ Ä‘Æ¡n giáº£n bÃ¡n cÃ¡c máº·t hÃ ng thá»i trang nhÆ° vÃ¡y, bikini, Ä‘á»“ hÃ¨, Ä‘á»“ máº·c Ä‘i biá»ƒn,... Dá»± Ã¡n Ä‘Æ°á»£c phÃ¡t triá»ƒn báº±ng Laravel Framework vá»›i thiáº¿t káº¿ hiá»‡n Ä‘áº¡i, dá»… sá»­ dá»¥ng vÃ  tÃ­ch há»£p cÃ¡c cÃ´ng nghá»‡ phá»• biáº¿n:

- **Laravel Breeze** â€“ ÄÄƒng kÃ½ / Ä‘Äƒng nháº­p ngÆ°á»i dÃ¹ng vÃ  phÃ¢n quyá»n cÆ¡ báº£n
- **Blade Template Engine** â€“ Táº¡o bá»‘ cá»¥c vÃ  view tÃ¡i sá»­ dá»¥ng
- **Tailwind CSS** â€“ Thiáº¿t káº¿ giao diá»‡n responsive, hiá»‡n Ä‘áº¡i
- **Eloquent ORM** â€“ Quáº£n lÃ½ dá»¯ liá»‡u theo mÃ´ hÃ¬nh Ä‘á»‘i tÆ°á»£ng
- **MySQL (Cloud â€“ Aiven)** â€“ CÆ¡ sá»Ÿ dá»¯ liá»‡u lÆ°u trá»±c tuyáº¿n
- **Báº£o máº­t há»‡ thá»‘ng**:
    - Token CSRF â€“ báº£o vá»‡ form
    - Session & Cookie â€“ quáº£n lÃ½ tráº¡ng thÃ¡i Ä‘Äƒng nháº­p
    - Validation â€“ kiá»ƒm tra dá»¯ liá»‡u Ä‘áº§u vÃ o
    - PhÃ²ng chá»‘ng **SQL Injection** & **XSS**

## ğŸ§© Chá»©c nÄƒng chÃ­nh
### ğŸ‘¤ NgÆ°á»i dÃ¹ng
- ÄÄƒng kÃ½ / Ä‘Äƒng nháº­p
- Xem sáº£n pháº©m (quáº§n Ã¡o)
- ThÃªm sáº£n pháº©m vÃ o giá» hÃ ng
- Thanh toÃ¡n Ä‘Æ¡n hÃ ng
- Xem lá»‹ch sá»­ mua hÃ ng
### ğŸ›  Quáº£n trá»‹ viÃªn (Admin)
- ÄÄƒng nháº­p riÃªng biá»‡t
- CRUD sáº£n pháº©m (quáº§n Ã¡o)
- Quáº£n lÃ½ Ä‘Æ¡n hÃ ng
- Quáº£n lÃ½ ngÆ°á»i dÃ¹ng
## âš™ï¸ CÃ´ng nghá»‡ sá»­ dá»¥ng

| CÃ´ng nghá»‡         | MÃ´ táº£                                              |
|------------------|----------------------------------------------------|
| Laravel          | Framework PHP chÃ­nh                                |
| Laravel Breeze   | XÃ¡c thá»±c ngÆ°á»i dÃ¹ng, session                        |
| Blade + Bootstrap| Giao diá»‡n ngÆ°á»i dÃ¹ng hiá»‡n Ä‘áº¡i                       |
| Eloquent ORM     | Truy váº¥n vÃ  thao tÃ¡c dá»¯ liá»‡u theo mÃ´ hÃ¬nh OOP      |
| MySQL (Aiven)    | CÆ¡ sá»Ÿ dá»¯ liá»‡u trá»±c tuyáº¿n (cloud database)          |
| Middleware       | PhÃ¢n quyá»n, kiá»ƒm tra truy cáº­p, CSRF token          |
---
## SÆ¡ Ä‘á»“ khá»‘i
![Biá»ƒu Ä‘á»“ khÃ´ng cÃ³ tiÃªu Ä‘á» drawio (3)](https://github.com/user-attachments/assets/065663b7-303e-4d0b-a33f-b80654adc587)
---
## SÆ¡ Ä‘á»“ chá»©c nÄƒng
![Biá»ƒu Ä‘á»“ khÃ´ng cÃ³ tiÃªu Ä‘á» drawio (6)](https://github.com/user-attachments/assets/04d5f583-12e9-4fa7-9f34-278ac2544055)
---
## Class Diagram of Objects 
![1 drawio](https://github.com/user-attachments/assets/9b8c1758-4ffb-4e3f-bb07-c30fbaed4133)
![2 drawio](https://github.com/user-attachments/assets/a8dde2d1-f981-4ebe-879f-8635198ed0da)
![3 drawio](https://github.com/user-attachments/assets/6f16f81d-b700-4cfc-be7c-fde89de6ca9a)
![4 drawio](https://github.com/user-attachments/assets/d06198f8-841d-4104-b0b1-8b279e189c71)


## Má»™t sá»‘ Code chÃ­nh minh há»a
### Model - Product

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Product extends Model
{
    protected $fillable = [
        'product_name',
        'product_price',
        'product_image',
    ];
}

```
### Model - Cart
```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use App\Models\Product;

class Cart extends Model
{
    protected $table = 'cart';

    protected $fillable = ['user_id', 'product_id', 'quantity'];

    // Quan há»‡: 1 Cart thuá»™c vá» 1 Product
    public function product()
    {
        return $this->belongsTo(Product::class);
    }
}

```

### Model Order
```php
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Order extends Model
{
    protected $fillable = [
        'user_id', 'name', 'phone', 'email', 'address', 'note',
        'delivery_method', 'payment_method', 'total', 'status'
    ];

    public function orderItems()
    {
        return $this->hasMany(OrderItem::class);
    }

    public function user()
    {
        return $this->belongsTo(User::class);
    }
}
```

### Model OrderItem
```php
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class OrderItem extends Model
{
    protected $fillable = [
        'order_id',
        'product_id',
        'quantity',
        'price'
    ];

   
    public function order()
    {
        return $this->belongsTo(Order::class);
    }

    public function product()
    {
        return $this->belongsTo(Product::class);
    }
}
```
### Controller - Product
```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Product;

class ProductController extends Controller
{
    public function index() {
        $products = Product::all();
        return view('admin.all_product', compact('products'));
    }

    public function create() {
        return view('admin.add_product');
    }

    public function store(Request $request)
    {
        $product = new Product();
        $product->product_name = $request->input('product_name');
        $product->product_price = $request->input('product_price');

        if ($request->hasFile('product_image')) {
            $image = $request->file('product_image');
            $imageName = time() . '_' . $image->getClientOriginalName();
            $image->move(public_path('uploads/product'), $imageName);
            $product->product_image = $imageName;
        }

        $product->save();

        return redirect('/admin/products')->with('success', 'ThÃªm sáº£n pháº©m thÃ nh cÃ´ng');
    }   

    public function edit($id) {
        $product = Product::findOrFail($id);
        return view('admin.edit_product', compact('product'));
    }

    public function update(Request $request, $id)
    {
        $product = Product::findOrFail($id);
        $product->product_name = $request->input('product_name');
        $product->product_price = $request->input('product_price');

        if ($request->hasFile('product_image')) {
            $image = $request->file('product_image');
            $imageName = time() . '_' . $image->getClientOriginalName();
            $image->move(public_path('uploads/product'), $imageName);
            $product->product_image = $imageName;
        }

        $product->save();

        return redirect('/admin/products')->with('success', 'Cáº­p nháº­t thÃ nh cÃ´ng');
    }


    public function destroy($id) {
        Product::destroy($id);
        return redirect('/admin/products');
    }

    public function showProducts()
    {
         $products = Product::all();
        return view('pages.Product', compact('products'));
    }
}
```
### Controller - Admin
``` php
<?php
namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use App\Models\Product;

class AdminController extends Controller
{
    public function showLoginForm()
    {
        return view('admin.login');
    }

    public function login(Request $request)
    {
        $credentials = $request->only('email', 'password');

        if (Auth::attempt($credentials)) {
    
            if (auth()->user()->is_admin) {
                return redirect()->route('admin.dashboard');
            }

            Auth::logout();
            return back()->withErrors(['email' => 'Báº¡n khÃ´ng cÃ³ quyá»n vÃ o admin']);
        }

        return back()->withErrors(['email' => 'ThÃ´ng tin Ä‘Äƒng nháº­p khÃ´ng há»£p lá»‡']);
    }

    public function dashboard()
    {   
        $products = Product::all(); 
        return view('admin.dashboard', compact('products'));
        if (!Auth::check()) {
            return redirect()->route('admin.login');
        }

        return view('admin.dashboard');
    }
}
```
### Controller - Cart
```php
<?php

namespace App\Http\Controllers;

use App\Models\Cart;
use App\Models\Product;
use Illuminate\Support\Facades\Auth;
use Illuminate\Http\Request;
use App\Models\Order;
use App\Models\OrderItem;

class CartController extends Controller
{
    public function addToCart($id)
    {
        $cart = Cart::where('user_id', Auth::id())
                    ->where('product_id', $id)
                    ->first();

        if ($cart) {
            $cart->quantity += 1;
            $cart->save();
        } else {
            Cart::create([
                'user_id' => Auth::id(),
                'product_id' => $id,
                'quantity' => 1,
            ]);
        }

        return redirect()->back()->with('success', 'ÄÃ£ thÃªm vÃ o giá» hÃ ng!');
    }
    
    public function removeFromCart($id)
    {
        $cart = Cart::find($id);
        if ($cart && $cart->user_id == Auth::id()) {
            $cart->delete();
        }

        return redirect()->route('cart.view')->with('success', 'ÄÃ£ xÃ³a sáº£n pháº©m');
    }

    public function viewCart()
    {
        $cartItems = Cart::where('user_id', Auth::id())->with('product')->get();
        $total = 0;

        foreach ($cartItems as $item) {
            $total += $item->product->product_price * $item->quantity;
        }

        return view('pages.cart', compact('cartItems', 'total'));
    }


    public function updateQuantity(Request $request)
    {
        foreach ($request->cart_ids as $index => $id) {
            $cart = Cart::find($id);
            if ($cart && $cart->user_id == Auth::id()) {
                $cart->quantity = $request->quantities[$index];
                $cart->save();
            }
        }

        return redirect()->back()->with('success', 'ÄÃ£ cáº­p nháº­t sá»‘ lÆ°á»£ng');
    }
        public function checkout()
    {
        $cartItems = Cart::where('user_id', Auth::id())->with('product')->get();
        $total = 0;

        foreach ($cartItems as $item) {
            $total += $item->product->product_price * $item->quantity;
        }

        return view('pages.checkout', compact('cartItems', 'total'));
    }
    public function ajaxUpdateQuantity(Request $request)
    {
        $cart = Cart::find($request->cart_id);

        if ($cart && $cart->user_id == Auth::id()) {
            $cart->quantity = $request->quantity;
            $cart->save();
            return response()->json(['success' => true]);
        }

        return response()->json(['success' => false], 403);
    }
    public function processCheckout(Request $request)
    {
        $request->validate([
            'address' => 'required|string|max:255',
            'payment_method' => 'required|string',
        ]);

        $cartItems = Cart::with('product')->where('user_id', Auth::id())->get();
        $total = $cartItems->sum(fn($item) => $item->product->product_price * $item->quantity);

        $order = Order::create([
            'user_id' => Auth::id(),
            'address' => $request->address,
            'payment_method' => $request->payment_method,
            'total' => $total,
        ]);

        foreach ($cartItems as $item) {
            OrderItem::create([
                'order_id' => $order->id,
                'product_id' => $item->product_id,
                'quantity' => $item->quantity,
                'price' => $item->product->product_price,
            ]);
        }

        Cart::where('user_id', Auth::id())->delete();

         return redirect()->route('cart.view')->with('success', 'ÄÆ¡n hÃ ng Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t thÃ nh cÃ´ng!');

    }
    public function placeOrder(Request $request)
    {
        return redirect('/')->with('success', 'Äáº·t hÃ ng thÃ nh cÃ´ng!');
    }

}
```
### Controller - Order
``` php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Cart;
use App\Models\Order;
use App\Models\OrderItem;
use Illuminate\Support\Facades\Auth;


class OrderController extends Controller
{
    // HÃ m xá»­ lÃ½ thanh toÃ¡n
    public function checkout()
    {
        // Láº¥y danh sÃ¡ch sáº£n pháº©m trong giá» hÃ ng
        $cartItems = Cart::with('product')->where('user_id', Auth::id())->get();

        // Náº¿u giá» hÃ ng trá»‘ng
        if ($cartItems->isEmpty()) {
            return redirect()->back()->with('error', 'Giá» hÃ ng cá»§a báº¡n Ä‘ang trá»‘ng.');
        }

        // TÃ­nh tá»•ng tiá»n
        $total = 0;
        foreach ($cartItems as $item) {
            $total += $item->product->product_price * $item->quantity;
        }

        // Táº¡o Ä‘Æ¡n hÃ ng má»›i
        $order = Order::create([
            'user_id' => Auth::id(),
            'total' => $total,
        ]);

        // Táº¡o cÃ¡c má»¥c trong Ä‘Æ¡n hÃ ng
        foreach ($cartItems as $item) {
            OrderItem::create([
                'order_id'   => $order->id,
                'product_id' => $item->product_id,
                'quantity'   => $item->quantity,
                'price'      => $item->product->product_price,
            ]);
        }

        // XÃ³a giá» hÃ ng sau khi thanh toÃ¡n
        Cart::where('user_id', Auth::id())->delete();

        // Redirect vá»›i thÃ´ng bÃ¡o
        return redirect()->route('cart.view')->with('success', 'Äáº·t hÃ ng thÃ nh cÃ´ng!');
    }

    public function placeOrder(Request $request)
    {
        $cartItems = Cart::where('user_id', Auth::id())->with('product')->get();

        if ($cartItems->isEmpty()) {
            return redirect()->back()->with('error', 'Giá» hÃ ng trá»‘ng!');
        }

        // 1. Táº¡o Ä‘Æ¡n hÃ ng
        $order = Order::create([
            'user_id' => Auth::id(),
            'name' => $request->name,
            'phone' => $request->phone,
            'email' => $request->email,
            'address' => $request->address,
            'note' => $request->note,
            'delivery_method' => $request->delivery_method,
            'total' => $cartItems->sum(fn($item) => $item->product->product_price * $item->quantity) + 20000,
        ]);

        // 2. Táº¡o tá»«ng sáº£n pháº©m trong Ä‘Æ¡n
        foreach ($cartItems as $item) {
            OrderItem::create([
                'order_id' => $order->id,
                'product_id' => $item->product->id,
                'quantity' => $item->quantity,
                'price' => $item->product->product_price,
            ]);
        }

        // 3. XoÃ¡ giá» hÃ ng
        Cart::where('user_id', Auth::id())->delete();

        // 4. Chuyá»ƒn hÆ°á»›ng kÃ¨m thÃ´ng bÃ¡o
        return redirect()->route('order.history')->with('success', 'Äáº·t hÃ ng thÃ nh cÃ´ng!');
    }

    public function orderHistory()
    {
        $orders = Order::where('user_id', Auth::id())->with('orderItems.product')->get();
        return view('pages.order_history', compact('orders'));
    }
}
```

### Route
``` php
<?php

use App\Http\Controllers\ProfileController;
use Illuminate\Support\Facades\Route;
use App\Http\Controllers\ProductController;
use App\Http\Controllers\AdminController;
use App\Http\Controllers\CartController;
use App\Http\Controllers\OrderController;
use App\Http\Controllers\AdminOrderController;

Route::get('/', function () {
    return view('welcome');
});
Route::get('/trang-chu', function () {
    return view('welcome');
});

Route::get('/dashboard', function () {
    abort(403, 'KhÃ´ng cÃ³ quyá»n truy cáº­p.');
})->middleware(['auth', 'verified', 'admin']);
Route::get('/dashboard', function () {
    return redirect('/san-pham'); 
})->middleware(['auth'])->name('dashboard');



Route::middleware('auth')->group(function () {
    Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');
    Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');
    Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');
});

// backend
Route::get('/admin/login', [AdminController::class, 'showLoginForm'])->name('admin.login');
Route::post('/admin/login', [AdminController::class, 'login'])->name('admin.login.post');

// product

Route::get('/admin/dashboard', [AdminController::class, 'dashboard'])->name('admin.dashboard');
Route::get('/admin/products', [ProductController::class, 'index']);
Route::get('/admin/products/create', [ProductController::class, 'create']);
Route::post('/admin/products', [ProductController::class, 'store']);
Route::get('/admin/products/{id}/edit', [ProductController::class, 'edit']);
Route::post('/admin/products/{id}/update', [ProductController::class, 'update']);
Route::get('/admin/products/{id}/delete', [ProductController::class, 'destroy']);
Route::get('/admin/orders', [AdminOrderController::class, 'index']);


// admin them san pham
Route::get('/san-pham', [ProductController::class, 'showProducts']);
require __DIR__.'/auth.php';

// cart
Route::post('/them-gio-hang/{id}', [CartController::class, 'addToCart'])->middleware('auth')->name('cart.add');

Route::get('/gio-hang', [CartController::class, 'viewCart'])->name('cart.view');
Route::get('/gio-hang/xoa/{id}', [CartController::class, 'removeFromCart'])->name('cart.remove');
Route::post('/gio-hang/cap-nhat', [CartController::class, 'updateQuantity'])->name('cart.update');
Route::get('/thanh-toan', [CartController::class, 'checkout'])->name('cart.checkout');
Route::post('/cart/update-quantity', [CartController::class, 'ajaxUpdateQuantity'])->name('cart.ajax.update');

// checkout
Route::get('/thanh-toan', [CartController::class, 'checkout']);
//Route::get('/thanh-toan', [CartController::class, 'checkoutForm'])->name('cart.checkout');
Route::post('/thanh-toan', [CartController::class, 'processCheckout'])->name('cart.processCheckout');
Route::post('/dat-hang', [OrderController::class, 'placeOrder'])->name('order.place');
Route::get('/thanh-toan', [CartController::class, 'checkout'])->name('cart.checkout');
Route::get('/gio-hang', [CartController::class, 'viewCart'])->name('cart.show');

// lich su don hang
Route::post('/dat-hang', [OrderController::class, 'placeOrder'])->name('order.place');
Route::get('/lich-su-don-hang', [OrderController::class, 'orderHistory'])->name('order.history');
Route::put('/admin/orders/{id}/approve', [AdminOrderController::class, 'approve']);
Route::delete('/admin/orders/{id}', [AdminOrderController::class, 'destroy']);
```


## Blade Template ( View )
![image](https://github.com/user-attachments/assets/06eda160-5ad8-4fa5-86aa-7ebf3c7e8be4)


## ğŸ” Security Setup
### CSRF
```php
 <form method="POST" action="{{ url('/admin/products') }}" enctype="multipart/form-data">
            @csrf

            <div class="mb-3">
                <label for="product_name" class="form-label">TÃªn sáº£n pháº©m</label>
                <input type="text" class="form-control" name="product_name" id="product_name" required>
            </div>
```
### Kiá»ƒm tra Ä‘áº§u vÃ o
```php
$request->validate([
    'address' => 'required|string|max:255',
    'payment_method' => 'required|string',
]);
```
### Chá»‘ng XSS. VÃ­ dá»¥ : order_history.blade.php
```php
<div style="padding-left: 10px;">
            @foreach ($order->orderItems as $item)
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                    <img src="{{ asset('uploads/product/' . $item->product->product_image) }}" alt="{{ $item->product->product_name }}" width="60" height="60" style="border-radius: 6px; border: 1px solid #ddd;">
                    <div>
                        <p style="margin: 0;"><strong>{{ $item->product->product_name }}</strong></p>
                        <p style="margin: 0;">SL: {{ $item->quantity }} x {{ number_format($item->price) }}Ä‘</p>
                    </div>
                </div>
            @endforeach
        </div>
```
### SQL Injection. VÃ­ dá»¥ AdminController
```php
 public function login(Request $request)
    {
        $credentials = $request->only('email', 'password');

        if (Auth::attempt($credentials)) {
    
            if (auth()->user()->is_admin) {
                return redirect()->route('admin.dashboard');
            }

            Auth::logout();
            return back()->withErrors(['email' => 'Báº¡n khÃ´ng cÃ³ quyá»n vÃ o admin']);
        }

        return back()->withErrors(['email' => 'ThÃ´ng tin Ä‘Äƒng nháº­p khÃ´ng há»£p lá»‡']);
    }
```
## Middleware phÃ¢n quyá»n cho Admin
```php
 public function handle(Request $request, Closure $next)
    {
        if (auth()->check() && auth()->user()->is_admin) {
            return $next($request);
        }

        return redirect('/'); // hoáº·c abort(403);
    }
```
## Má»™t sá»‘ hÃ¬nh áº£nh chá»©c nÄƒng chÃ­nh
### Trang Ä‘Äƒng nháº­p ( xÃ¡c thá»±c ) 

- **ğŸ”’ ÄÄƒng nháº­p :**
![image](https://github.com/user-attachments/assets/bd91d47c-b789-464e-a8f7-b7f0ddb2ab1a)

- **ğŸ”’ ÄÄƒng kÃ½ :**
![image](https://github.com/user-attachments/assets/7201e623-7e9f-4123-ba17-516f4b1dcec1)

- **Trang chá»§ :**
![image](https://github.com/user-attachments/assets/2dabc28d-8051-47e1-8e69-168e66f6c911)

- **Trang sáº£n pháº©m :**
![image](https://github.com/user-attachments/assets/7711a54b-9a80-454d-94b5-c5eb00599608)

- **Trang giá» hÃ ng :**
![image](https://github.com/user-attachments/assets/c117c9df-aca9-4408-b595-307a68e85207)

- **Trang thanh toÃ¡n :**
![image](https://github.com/user-attachments/assets/31effac7-f897-4f25-88b9-ff41fcf5208e)

- **Trang dashboard :**
![image](https://github.com/user-attachments/assets/7af36e4a-8835-4d1f-95db-f92c6191a3f4)

- **Trang quáº£n lÃ½ sáº£n pháº©m ( CRUD product ) :**
![image](https://github.com/user-attachments/assets/80973e6e-2451-4c99-a4d2-9ba280acab0c)

- **Trang quáº£n lÃ½ Ä‘Æ¡n hÃ ng :**
![image](https://github.com/user-attachments/assets/82e353d4-cacf-495c-958f-463c67f74fc1)


- **Link Demo :**  [Youtube link](https://youtu.be/4DpNjZAzmkI?si=ek-PCW7GFHgGrnwC)
- **Link Github :** https://github.com/eniuu127/project_webnangcao.git
- **Link Github pages:**[ https://github.com/eniuu127/project_webnangcao.git](https://eniuu127.github.io/project_webnangcao/)

License & Copy Rights

The Laravel framework is open-sourced software licensed under the [MIT license](https://opensource.org/licenses/MIT).
